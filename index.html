<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Timetable</title>
	<!-- <link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css"> -->

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="css/bootstrap-theme.min.css">

	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

</head>
<body>
<style type="text/css">
	.glyphicon-minus{
		color: red!important;
	}
	table span:hover{
		cursor: pointer;
		/*background-color: #eee; */
	}

	table .glyphicon-plus{
		cursor: pointer;
		display: block!important;
		padding-bottom: 4px;
	}
	table td div span:hover{
		cursor: pointer;
		/*background-color: #2382D5; */
	}

	table td div .glyphicon-remove{
		padding-left: 4px!important;
	}

	.drop{
		padding: 0!important;
	}
	.w50{
		width: 50%!important;display: inline-block;
	}
	.w33{
		width: 33.3333333333%!important;display: inline-block;
	}

	.w25{
		width: 25%!important;display: inline-block;
	}
	.w100{
		width: 100%!important;
	}
	.session-data{
		border:1px solid #ddd;padding: 9px;;
	}
	.session-mix-time{
		font-size: 10px;
	    width: auto;
	    border-bottom: 1px solid #ddd;
	    padding-left: 27px;
	    padding-bottom: 2px;
	}
</style>
	<div class="container">
		<div class="right">
			<table class="table table-bordered table-responsive">
				<tr>
					<td class="blank"></td>
					<td class="title">09:00 - 10.30</td>
					<td class="title">11.00 - 12.30</td>
					<td class="title">14:00 - 15.30</td>
					<td class="title">16.00 - 17.30</td>
				</tr>
				<tr>
					<td class="time">Monday</td>
					<td class="drop" data-from="09:00" data-to="10:30" data-sessions="0" data-booked-upto="09:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="11:00" data-to="12:30" data-sessions="0" data-booked-upto="11:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="14:00" data-to="15:30" data-sessions="0" data-booked-upto="14:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="16:00" data-to="17:30" data-sessions="0" data-booked-upto="16:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					
				</tr>
				<tr>
					<td class="time">Tuesday</td>
					<td class="drop" data-from="09:00" data-to="10:30" data-sessions="0" data-booked-upto="09:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="11:00" data-to="12:30" data-sessions="0" data-booked-upto="11:00" ><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="14:00" data-to="15:30" data-sessions="0" data-booked-upto="14:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="16:00" data-to="17:30" data-sessions="0" data-booked-upto="16:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					
				</tr>
				<tr>
					<td class="time">Wednesday</td>
					<td class="drop" data-from="09:00" data-to="10:30" data-sessions="0" data-booked-upto="09:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>

					<td class="drop" data-from="11:00" data-to="12:30" data-sessions="0" data-booked-upto="11:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="14:00" data-to="15:30" data-sessions="0" data-booked-upto="14:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="16:00" data-to="17:30" data-sessions="0" data-booked-upto="16:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
				
				</tr>
				<tr>
					<td class="time">Thursday</td>
					<td class="drop" data-from="09:00" data-to="10:30" data-sessions="0" data-booked-upto="09:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="11:00" data-to="12:30" data-sessions="0" data-booked-upto="11:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="14:00" data-to="15:30" data-sessions="0" data-booked-upto="14:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="16:00" data-to="17:30" data-sessions="0" data-booked-upto="16:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					
				</tr>
				<tr>
					<td class="time">Friday</td>
					<td class="drop" data-from="09:00" data-to="10:30" data-sessions="0" data-booked-upto="09:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="11:00" data-to="12:30" data-sessions="0" data-booked-upto="11:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="14:00" data-to="15:30" data-sessions="0" data-booked-upto="14:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					<td class="drop" data-from="16:00" data-to="17:30" data-sessions="0" data-booked-upto="16:00"><span data-target="#myModal" data-toggle="modal" class="glyphicon glyphicon-plus"></span></td>
					
				</tr>

			</table>
		</div>
	</div>

<!-- create session modal starts here -->
<div id="myModal" class="modal fade">
	<form id="timetable" name="timetable">
		<div class="modal-dialog">
			<!-- Modal content--> 
			<div class="modal-content">
				<div class="modal-header">
					<button class="close" type="button" data-dismiss="modal">&times;</button> 
					<h4 class="modal-title">Add Session</h4>
				</div>
				<div class="modal-body">
					<div class="form-group"><label for="faculty_name">Faculty Name:</label> <input name="faculty_name" id="faculty_name" class="form-control" type="text" /></div>
					<div class="form-group"><label for="session_name">Session Name:</label> <input name="session_name" id="session_name" class="form-control" type="text" /></div>
					<div class="form-group"><label for="session_time_from">Session Time From:</label> <input name="session_time_from" id="session_time_from" class="form-control" type="time" readonly /></div>
					<div class="form-group"><label for="session_time_to">Session Time To:</label> <input name="session_time_to" id="session_time_to" class="form-control" type="time"/></div>
				</div>
				<div class="modal-footer"><a href="javascript:;" class="btn btn-default" id="timetableSubmit">Submit</a> <button class="btn btn-default" type="button" data-dismiss="modal">Close</button></div>
			</div>
		</div>
	</form>
</div>
<!-- create session modal ends here -->

<!-- edit session modal starts here -->
<div id="sessionModal" class="modal fade">
	<form id="timetable" name="timetable">
		<div class="modal-dialog">
			<!-- Modal content--> 
			<div class="modal-content">	
				<div class="modal-header">
					<button class="close" type="button" data-dismiss="modal">&times;</button> 
					<h4 class="modal-title">Edit Session</h4>
				</div>
				<div class="modal-body">
					<div class="form-group"><label for="faculty_name_edit">Faculty Name:</label> <input name="faculty_name_edit" id="faculty_name_edit" class="form-control" type="text" /></div>
					<div class="form-group"><label for="session_name">Session Name:</label> <input name="session_name_edit" id="session_name_edit" class="form-control" type="text" /></div>
					<div class="form-group"><label for="session_time_from_edit">Session Time From:</label> <input name="session_time_from_edit" id="session_time_from_edit" class="form-control" type="time" readonly /></div>
					<div class="form-group"><label for="session_time_to_edit">Session Time To:</label> <input name="session_time_to_edit" id="session_time_to_edit" class="form-control" type="time"/></div>
				</div>
				<div class="modal-footer">
					<a href="javascript:;" class="btn btn-default pull-left timetableDelete" id="timetableDelete">Delete</a>
					<a href="javascript:;" class="btn btn-default" id="edittimetableSubmit">Submit</a>
					<button class="btn btn-default" type="button" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</form>
</div>
<!-- edit session modal ends here -->

<script type="text/javascript">
	var slot;
	
	$('.drop').click(function(e) {
	   e.preventDefault();
	   slot = $(e.target);
	   if (!slot.is('td')) {slot = slot.parent('td');}
	});

	var fromTime;
	var uptoTime;
	var deleteThat ='';
	var deleteSessionFromTime = '';
	var toTime;
	var editSessionDiv;
	var regExp = /(\d{1,2})\:(\d{1,2})/;
	$('#myModal').on('shown.bs.modal', function(e) {
		fromTime = slot.attr('data-booked-upto');
		
		$('#session_time_from').val(fromTime);

		toTime = slot.attr('data-to');
		
		$('#session_time_to').val(toTime);
    });

	//create new session functionality
	$('#timetableSubmit').click(function(){
			var fn = $('#faculty_name').val();
			var sn = $('#session_name').val();
			var to = $('#session_time_to').val();
				
			var total = parseInt(to .replace(regExp, "$1$2")) - parseInt(fromTime .replace(regExp, "$1$2"));
			var error = false;
			//total = total/100;

			if (fn == '') {
				$('#faculty_name').after('<span class="error">Please enter faculty name<span>');
				error = true;
			}

			if (sn == '') {
				$('#session_name').after('<span class="error">Please enter session name</span>');
				error = true;
			}

			if (!error) {	

				if(parseInt(to .replace(regExp, "$1$2")) < parseInt(toTime .replace(regExp, "$1$2"))){
						slot.append('<div class="session-data" >'+sn+'<br><b> - '+fn+'</b>'+'<span class="glyphicon glyphicon-remove timetableDelete pull-right" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+fromTime+'" data-to="'+to+'"></span><span data-target="#sessionModal" data-toggle="modal" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+fromTime+'" data-to="'+to+'" class="glyphicon glyphicon-edit pull-right"></span></div>');
				}else if(parseInt(to .replace(regExp, "$1$2")) > parseInt(toTime .replace(regExp, "$1$2"))){
						//if the session is taking to time more than existing td then 
						//merge the next td also.
						var nextSlotTo = slot.next().attr('data-to');
						slot.next().remove();
						slot.attr('colspan','2');
						slot.attr('data-to',nextSlotTo);
						slot.append('<div class="session-data" >'+sn+'<br><b> - '+fn+'</b>'+'<span class="glyphicon glyphicon-remove timetableDelete pull-right" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+fromTime+'" data-to="'+to+'"></span><span data-target="#sessionModal" data-toggle="modal" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+fromTime+'" data-to="'+to+'" class="glyphicon glyphicon-edit pull-right"></span></div>');
				}else{
						slot.append('<div class="session-data" >'+sn+'<br><b> - '+fn+'</b><span class="glyphicon glyphicon-remove timetableDelete pull-right" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+fromTime+'" data-to="'+to+'"></span><span data-target="#sessionModal" data-toggle="modal" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+fromTime+'" data-to="'+to+'" class="glyphicon glyphicon-edit pull-right"></span></div>');	
				}

				slot.children().last().prepend('<div class="session-mix-time">'+fromTime+' - '+to+'</div>');
				
				slot.attr('data-sessions',parseInt(slot.attr('data-sessions'))+1);
				
				slot.attr('data-booked-upto',to);
						
				if (parseInt(slot.attr('data-sessions'))>1 && parseInt(slot.attr('data-sessions'))<3) {
					slot.children('.session-data').addClass('w50');
					$('.session-mix-time').show();	
				}else if(parseInt(slot.attr('data-sessions'))>2 && parseInt(slot.attr('data-sessions'))<4){
					slot.children('.session-data').addClass('w33');
					$('.session-mix-time').show();
				}else if(parseInt(slot.attr('data-sessions'))>3 && parseInt(slot.attr('data-sessions'))<5){
					slot.children('.session-data').addClass('w25');
				}				

				$('#faculty_name').val('');
				$('#session_name').val('');
				$('#myModal').modal('hide');
			}
	 });
	 
	//update session functionality
	$('#edittimetableSubmit').click(function(){

			var fn = $('#faculty_name_edit').val();
			var sn = $('#session_name_edit').val();
			var to = $('#session_time_to_edit').val();
			var from = $('#session_time_from_edit').val();
			var total = parseInt(to .replace(regExp, "$1$2")) - parseInt(fromTime .replace(regExp, "$1$2"));
			var error = false;

			if (fn == '') {
				$('#faculty_name_edit').after('<span class="error">Please enter faculty name<span>');
				error = true;
			}

			if (sn == '') {
				$('#session_name_edit').after('<span class="error">Please enter session name</span>');
				error = true;
			}

			if (!error) {	

				var timeDiv = '<div class="session-mix-time">'+from+' - '+to+'</div>';
				if(parseInt(to .replace(regExp, "$1$2")) < parseInt(toTime .replace(regExp, "$1$2"))){
						editSessionDiv.replaceWith('<div class="session-data" >'+timeDiv+sn+'<br><b> - '+fn+'</b>'+'<span class="glyphicon glyphicon-remove timetableDelete pull-right" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+from+'" data-to="'+to+'"></span><span data-target="#sessionModal" data-toggle="modal" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+from+'" data-to="'+to+'" class="glyphicon glyphicon-edit pull-right"></span></div>');
				}else if(parseInt(to .replace(regExp, "$1$2")) > parseInt(toTime .replace(regExp, "$1$2"))){
						//if the session is taking to time more than existing td then 
						//merge the next td also.
						var nextSlotTo = slot.next().attr('data-to');
						slot.next().remove();
						slot.attr('colspan','2');
						slot.attr('data-to',nextSlotTo);
						editSessionDiv.replaceWith('<div class="session-data" >'+timeDiv+sn+'<br><b> - '+fn+'</b>'+'<span class="glyphicon glyphicon-remove timetableDelete pull-right" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+from+'" data-to="'+to+'"></span><span data-target="#sessionModal" data-toggle="modal" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+from+'" data-to="'+to+'" class="glyphicon glyphicon-edit pull-right"></span></div>');
				}else{
						editSessionDiv.replaceWith('<div class="session-data" >'+timeDiv+sn+'<br><b> - '+fn+'</b><span class="glyphicon glyphicon-remove timetableDelete pull-right" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+from+'" data-to="'+to+'"></span><span data-target="#sessionModal" data-toggle="modal" data-session="'+sn+'" data-faculty="'+fn+'" data-from="'+from+'" data-to="'+to+'" class="glyphicon glyphicon-edit pull-right"></span></div>');	
				}

				if (parseInt(slot.attr('data-booked-upto').replace(regExp, "$1$2")) < parseInt(to.replace(regExp, "$1$2"))) {
					slot.attr('data-booked-upto',to);
				}

				if (parseInt(slot.attr('data-sessions'))>1 && parseInt(slot.attr('data-sessions'))<3) {
					slot.children('.session-data').addClass('w50');
				}else if(parseInt(slot.attr('data-sessions'))>2 && parseInt(slot.attr('data-sessions'))<4){
					slot.children('.session-data').addClass('w33');
				}else if(parseInt(slot.attr('data-sessions'))>3 && parseInt(slot.attr('data-sessions'))<5){
					slot.children('.session-data').addClass('w25');
				}				

				$('#faculty_name_edit').val('');
				$('#session_name_edit').val('');
				$('#sessionModal').modal('hide');
			}
	 });
	 //code for editing a session
	 $('#sessionModal').on('shown.bs.modal', function(e) {
		 var div = $(e.relatedTarget) // Button that triggered the modal
		 deleteThat = div;
		 var faculty= div.attr('data-faculty'); // Extract info from data-* attributes
		 var session= div.attr('data-session'); // Extract info from data-* attributes
		 var from= div.attr('data-from'); // Extract info from data-* attributes
	     var to= div.attr('data-to'); // Extract info from data-* attributes
	     deleteSessionFromTime = from;
	     slot = div.parent().parent('td');
	     var modal = $(this);

	     modal.find('#faculty_name_edit').val(faculty);
	     modal.find('#session_name_edit').val(session);
	     modal.find('#session_time_from_edit').val(from);

	     if (parseInt(to.replace(regExp, "$1$2")) > parseInt(slot.attr('data-booked-upto').replace(regExp, "$1$2"))) {
	     	modal.find('#session_time_to_edit').val(to);
	     }else{
	     	modal.find('#session_time_to_edit').val(to);
	     	modal.find('#session_time_to_edit').attr('max',to);
	     	modal.find('#session_time_to_edit').attr('min',from);
	     }
	     	
	     editSessionDiv = div.parent('div');
	 });

 	 //when user clicks on delete session button
 	 $(document).on('click', '.timetableDelete',function(e){
 	 	if (deleteThat == '') {deleteThat = $(e.target);}
 	 	
 	 	if (deleteSessionFromTime == '') {deleteSessionFromTime = deleteThat.attr('data-from');}
 	 	
	 	deleteSession(deleteThat,deleteSessionFromTime);
	 	deleteThat = '';
	 	deleteSessionFromTime = '';
	 });

	//delete session functionality
	function deleteSession(that,from) {
		
		if (confirm('Are you sure you want to delete this session from timetable?')) {

			var thisSlot = that.closest('td'); 
			if (thisSlot.is('td')) {thisSlot = that.parent().parent('td');}
    		
    		//remove the div
    		that.parent('div').remove();
    		//update count of number of sessions
    		thisSlot.attr('data-sessions',parseInt(thisSlot.attr('data-sessions'))-1);
    		//update the booked upto time
    		thisSlot.attr('data-booked-upto',from);
			thisSlot.children('.session-data').removeClass('w50');
			thisSlot.children('.session-data').removeClass('w33');
			
			if (parseInt(thisSlot.attr('data-sessions'))>1 && parseInt(thisSlot.attr('data-sessions'))<3) {
				thisSlot.children('.session-data').addClass('w50');
				$('.session-mix-time').show();	
			}else if(parseInt(thisSlot.attr('data-sessions'))>2 && parseInt(thisSlot.attr('data-sessions'))<4){
				thisSlot.children('.session-data').addClass('w33');
				
			}else if(parseInt(thisSlot.attr('data-sessions')) == 1){
				thisSlot.children('.session-data').addClass('w100');
			}

			$('#sessionModal').modal('hide');
		} else {
		    // Do nothing!
		}
	}
</script>
</body>
</html>